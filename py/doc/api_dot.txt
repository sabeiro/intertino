Documentazione API Dot&Ads (v1)
Versione
Data
Autore
Descrizione
1.0
08-07-2016
Emmanuele Abbenante
(emmanuele.abbenante@dotandmedia.com)
Versione iniziale.
1.1
16-11-2016
Emmanuele Abbenante
(emmanuele.abbenante@dotandmedia.com)
Aggiunti  i seguenti servizi:
“uiToken”
“nodes”
“sizesPositions”
reports/monetization


Indice generale
 1 Informazioni generali	4
 1.1 Infrastruttura	4
 1.2 Sicurezza	4
 1.3 Request	4
 1.3.1 Body	4
 1.4 Response	5
 1.4.1 Stati HTTP	5
 1.4.2 Body	6
 2 Risorse	7
 2.1 token	7
 2.1.1 Get token	7
 2.1.1.1 Request	7
 2.1.1.2 Response	8
 2.2 uiToken	8
 2.2.1 Get token	8
 2.2.1.1 Request	8
 2.2.1.2 Response	9
 2.3 reports	9
 2.3.1 Request report	9
 2.3.1.1 Request	10
 2.3.1.1.1 Report multidimensionali	12
 2.3.1.2 Response	15
 2.3.2 Get report	16
 2.3.2.1 Request	16
 2.3.2.2 Response	17
 2.4 flights	17
 2.4.1 Get flight list	17
 2.4.1.1 Request	17
 2.4.1.2 Response	18
 2.5 nodes	21
 2.5.1 Get nodes	21
 2.5.1.1 Request	21
 2.5.1.2 Response	21
 2.6 sizesPositions	23
 2.6.1 Get sizes and positions	23
 2.6.1.1 Request	24
 2.6.1.2 Response	24
 2.7 reports/monetization	25
 2.7.1 Get monetization report	25
 2.7.1.1 Request	26
 2.7.1.2 Response	27





 1  Informazioni generali

	Questo documento descrive i dettagli dell'API REST dell'applicazione Dot&Ads.
In questo capitolo introduttivo sono riportate delle informazioni che valgono per tutti i servizi dell'API.
	Nel capitolo successivo saranno illustrate le risorse accessibili tramite API e le operazioni che è possibile effettuare su di esse.

 1.1  Infrastruttura

	L’indirizzo di base a cui raggiungere le API è

 http://api.dashboard.ad.dotandad.com:9190

a cui va concatenato il path della risorsa che si vuole richiedere, compreso il prefisso “/api/v1/” (es. “/api/v1/token”).

 1.2  Sicurezza

	Ogni metodo richiede un token di autenticazione, a parte quello della login che richiede le credenziali.

 1.3  Request

	Il body delle request, dove richiesto, è nel formato JSON. 
	I campi sono tutti obbligatori, a meno che non siano marcati esplicitamente come opzionali.

 1.3.1  Body

	Il body di una generica request contiene i seguenti campi:

Campo
Tipo
Descrizione/Valori
token
string
Token per autenticare la richiesta.
request
object
Contiene eventuali parametri di input necessari per richiedere una specifica risorsa.
pagination
(opzionale)
Pagination
Parametri relativi alla paginazione.




Pagination

Campo
Tipo
Descrizione/Valori
rowNumber
number
Numero massimo di record da restituire ad ogni chiamata.
page
number
Indice incrementale che identifica il sottoinsieme di record da restituire.

Esempio:

{  
   "token":"67f82b35-0733-48d6-a1c8-42505e640483",
   "request":{  
      "status":1
   },
   "pagination":{  
      "rowNumber":20,
      "page":1
   }
}

Per ogni risorsa nel seguito saranno indicati solo i campi relativi all'oggetto “request”.

 1.4  Response

	Dove non specificato diversamente, la response è nel formato JSON e ha la struttura indicata di seguito.

 1.4.1  Stati HTTP

	Di seguito sono indicati gli stati HTTP utilizzati dall'API:

2XX - Successo
4XX - Errore lato client
5XX - Errore lato server


Stato
Descrizione
200
OK
400
Bad request
401
Authentication failure
404
Resource not found
500
Internal server error

 1.4.2  Body

	Il body di una generica response contiene i seguenti campi:

Campo
Tipo
Descrizione/Valori
isError
boolean
Flag che indica se si è verificato un errore o meno.
resource (opzionale)
object
Contenuto della risorsa richiesta.
errorMsg (opzionale)
string
Messaggio che fornisce maggiori informazioni su un errore eventualmente verificatosi.

Esempio (successo):

{  
   "isError":false,
   "resource":{  
      "token":"4b462e99-216a-4038-831d-d0fea6920698"
   }
}

Esempio (errore):

{  
   "isError":true,
   “errorMsg”: “Malformed request JSON”
}

Uno tra i campi “resource” e “errorMsg” è sempre presente.
Per ogni risorsa nel seguito saranno indicati solo i campi relativi all'oggetto “resource”.



 2  Risorse

 2.1  token

 2.1.1  Get token

	Restituisce un token per autenticare le successive chiamate all'API. La sessione che viene creata in seguito all'autenticazione dura 30 minuti.

 2.1.1.1  Request


Metodo
URI
POST
token

Header

Nessuno

Parametri

Nessuno

Body

Campo
Tipo
Descrizione/Valori
username
string
Dato fornito da Dot&Media.
password
string


Esempio

POST /api/v1/token

{  
   "username":"user@dotandmedia.com",
   "password":"DfFb7Gh37a12"
}




 2.1.1.2  Response

Header

Nessuno

Body

Campo
Tipo
Descrizione/Valori
token
string
Identificatore univoco per la sessione corrente.

Esempio

{  
   "resource":{  
      "token":"4b462e99-216a-4038-831d-d0fea6920698"
   },
   "isError":false
}


 2.2  uiToken

 2.2.1  Get token

	Restituisce un token di autenticazione a partire da una sessione della UI.

 2.2.1.1  Request


Metodo
URI
POST
uiToken

Header

Nessuno

Parametri

Nessuno





Body

Campo
Tipo
Descrizione/Valori
uiSessionId
string
Session id della UI, da popolare con il valore contenuto nel cookie con chiave “ubridge”.

Esempio

POST /api/v1/uiToken

{
	"uiSessionId": "C5708F3B6DE4DFBB1DA53DD2255ABFBF"
}




 2.2.1.2  Response

Header

Nessuno

Body

Campo
Tipo
Descrizione/Valori
token
string
Identificatore univoco per la sessione corrente.

Esempio

{  
   "resource":{  
      "token":"4b462e99-216a-4038-831d-d0fea6920698"
   },
   "isError":false
}


 2.3  reports

 2.3.1  Request report

	Richiede la generazione del report indicato utilizzando i campi/filtri specificati.
	La generazione del report avviene in maniera asincrona. Il servizio restituisce un identificatore univoco che permette di recuperare il report in un secondo momento (vedere paragrafo 2.2.2 Get report).

 2.3.1.1  Request


Metodo
URI
POST
reports

Header

Nessuno

Parametri

Nessuno





Body

Campo
Tipo
Descrizione/Valori
reportId
string
Identificativo alfanumerico per il report da generare.
Dato fornito da Dot&Media.
fields
Field[]
Array contenente i campi che dovranno essere presenti nel report e/o eventuali condizioni per generare il report.

Field

Campo
Tipo
Descrizione/Valori
id
string
Id del campo.
Più sotto in questo paragrafo sono elencati tutti i campi ammessi.
visible
(opzionale)
boolean
Flag che indica se mostrare o meno il campo nel report. Da utilizzare se si vuole impiegare il campo solo come filtro.
Default: true.
sortp
(opzionale)
number
Priorità con cui il campo deve essere considerato nell'ordinamento dei record.
La priorità 0 è la più alta.
Default: 0.
sortd
(opzionale)
string
Direzione di ordinamento.
Valori ammessi:
asc;
desc.
Default: “asc”.
filters
(opzionale)
Filter[][]
Array di condizioni da applicare al campo nella generazione del report. Le condizioni specificate in questo array saranno poste in AND.
Ogni elemento di questo array è a sua volta un array, e le condizioni specificate in questo secondo array saranno poste in OR.

Filter

Campo
Tipo
Descrizione/Valori
op
string
Operatore da utilizzare nella condizione.
Valori ammessi:
STARTS_WITH
ENDS_WITH
CONTAINS
=
>
<
>=
<=
v
array
Array dei valori da applicare nella condizione. Saranno generate tante condizioni quanti sono i valori, e tali condizioni saranno poste in OR.

	Per maggiore chiarezza si riporta di seguito un esempio di traduzione di un filtro:

{  
   "id":"OrderId",
   "filters":[  
      [  
         {  
            "op":"=",
            "v":[123,456]
         },
         {  
            "op":">=",
            "v":[600]
         }
      ],
      [  
         {  
            "op":"<",
            "v":[999]
         }
      ]
   ]
}

verrebbe tradotto nella condizione

( ( OrderId=123 OR OrderId=456 ) OR OrderId>=600 ) AND OrderId < 999

 2.3.1.1.1  Report multidimensionali

	È possibile richiedere tale tipo di report specificando come report id “MD”.
	Elenco dei campi che è possibile utilizzare nel report:

Campo
Tipo
Descrizione/Valori
Action


AdDescription
string
Descrizione ad.
AdExtID
string
Codice esterno ad.
AdId
number
Id ad.
AdQuota


AdSizeRefId
string

AdTemplateDescription
string

AdTemplateExtID
string

AdType
string

AdvertiserID
number
Id advertiser.
AdvertiserName
string
Nome advertiser.
AdvertiserType
number
Tipo advertiser.
Valori ammessi:
1 (Autopromo)
2 (Default)
0 (Paganti) 
AdWeight
number

Area


Channel
string

Ctr
number
Rapporto click/impression in percentuale.
Date
string

FlightStartDate
string
Data e ora inizio flight.
DeviceType
string
Valori ammessi:
Tablet
Console
Mobile Device
FonePad
Car Entertainment System
TV Device
Ebook Reader
Unknown
Desktop
Mobile Phone 
FlightAbsoluteEndDate
string
Data e ora fine assoluta flight.
FlightCapDescription
string
Descrizione cap flight.
FlightCapExtID
string
Codice esterno cap flight.
FlightDescription
string
Descrizione flight.
FlightEndDate
string
Data e ora fine flight.
FlightExtId
string
Codice esterno flight.
FlightID
number
Id flight.
FlightLayer
string
Descrizione del livello a cui il flight è stato caricato a sistema
FlightPrice
number

FlightTotalSales
number

ImpsGoal
number
Goal totale impression del flight.
Keyword
string

MccDescription
string

MediapointId
number
Id mediapoint.
MediapointTAG
string
Tag mediapoint.
Netspeed


NL7Description
string

Click
number
Numero click erogati.
Imps
number
Numero impression erogate.
OrderDescription
string
Descrizione ordine.
OrderExtId
string
Codice esterno ordine.
OrderId
number
Id ordine.
Position
number

UserProfiles


Publisher
string

Registration
number

Section
string

Site
string

Size
string

SmartPassback
number


Esempio

POST /api/v1/reports

{  
   "token":"f59f3868-4148-466b-9dc5-93b43004a012",
   "request":{  
      "reportId":"MD",
      "fields":[  
  {  
            "id":"Date",
            "visible": false,
            "sortp":1,
            "filters":[  
               [  
                  {  
                     "op":"=",
                     "v": ["2016-01-12"]
                  }
               ]
            ]
        },         
  {  
            "id":"OrderId",
            "sortp":2,
            "sortd":"desc",
            "filters":[  
               [  
                  {  
                     "op":"=",
                     "v":[123,456]
                  },
                  {  
                     "op":">=",
                     "v":[600]
                  }
               ],
               [  
                  {  
                     "op":"<",
                     "v":[999]
                  }
               ]
            ]
         },
         {  
            "id":"AdvertiserId",
            "sortp":1
         },
         {  
            "id":"AdId",
            "visible":false,
            "filters":[  
               [  
                  {  
                     "op":"<=",
                     "v":[764]
                  }
               ]
            ]
         } ,
         {  
            "id":"Imps"
         }
      ]
   }
}

 2.3.1.2  Response

Header

Nessuno

Body

Campo
Tipo
Descrizione/Valori
reportUuid
string
Identificatore univoco per il report richiesto. Tale identificativo va utilizzato per scaricare il report (vedere paragrafo 2.2.2 Get report).

Esempio

{  
   "resource":{  
      "reportUuid":"4f9af00e-d37d-4f6c-b091-43fd794f6d1f"
   },
   "isError":false
}


 2.3.2  Get report

	Restituisce un report richiesto in precedenza.

 2.3.2.1  Request


Metodo
URI
POST
reports/{reportUuid}

Header

Nessuno

Parametri

Campo
Tipo
Descrizione/Valori
reportUuid
string
Identificatore univoco per il report richiesto.

Body

Il body dovrà contenere soltanto il campo “token”, necessario per l'autenticazione della chiamata.





Esempio

POST /api/v1/reports/4f9af00e-d37d-4f6c-b091-43fd794f6d1f

{  
   "token":"f59f3868-4148-466b-9dc5-93b43004a012"
}


 2.3.2.2  Response

Header

Campo
Descrizione/Valori
Column-Names
Header custom che contiene l'elenco dei campi selezionati come colonne del report, separati dal carattere “|”. La disposizione dei dati all'interno del report rispetta quella specificata in questo header.
Esempio:

Column-Names: OrderId|AdvertiserID|AdId

Body

Il body è costituito esclusivamente dal report in formato CSV compresso con GZIP.


 2.4  flights

 2.4.1  Get flight list

	Restituisce la lista di flight corrente che corrispondono ai criteri eventualmente selezionati.
	Questo servizio permette di paginare il risultato.

 2.4.1.1  Request


Metodo
URI
POST
flights

Header

Nessuno



Parametri

Nessuno

Body

Campo
Tipo
Descrizione/Valori
status
number
Stato flight.
Valori ammessi:
  1 (Inattivo)
  3 (Prenotato)
  2 (Archiviato)
  10 (In erogazione)
  11 (Erogazione Terminata)
  12 (Erogazione Futura)
  13 (Errata)
  14 (Erogazione Incompleta)


Esempio

POST /api/v1/flights

{  
   "token":"67f82b35-0733-48d6-a1c8-42505e640483",
   "request":{  
      "status":1
   },
   "pagination":{  
      "rowNumber":20,
      "page":1
   }
}


 2.4.1.2  Response

Header

Nessuno

Body

Campo
Tipo
Descrizione/Valori
start_ts
string
Data e ora inizio flight.
ctr
number
Rapporto click/impression in percentuale.
last_edit_by
number
Id dell'utente che ha modificato per ultimo il flight.
advertiser_description
string
Descrizione advertiser.
osi
number

order_description
string
Descrizione ordine.
imps_goal_daily
number
Obiettivo giornaliero per le impression.
description
string
Descrizione flight.
last_edit_ts
string
Data e ora dell'ultima modifica al flight.
layer
string
Descrizione del livello a cui il flight è stato caricato a sistema
advertiser_id
number
Id advertiser.
imps_served
number
Numero impression erogate.
absolute_end_ts
number
Data e ora fine assoluta flight.
imps_distribution
number
Erogazione impression.
Valori ammessi:
1 (ASAP);
2 (DynImps)
3 (Clicks)
flight_cap_description
string
Descrizione cap flight.
marker
number
Valori ammessi:
0 (nessuno)
10 (Grigio)
50 (Blu)
20 (Verde)
30 (Giallo)
40 (Rosso)
60 (Viola)
70 (Nero)
80 (Marrone)
90 (Arancio)
subflight_ref_code
string
Codice esterno flight.
flight_cap_flight_ref_code
string
Codice esterno cap flight.
desired_end_ts
string
Data e ora fine flight.
click_served
number
Numero click erogati.
imps_goal_total
number
Obiettivo totale per le impression.
order_id
number
Id ordine.
subflight_id
number
Id flight.
status
number
Stato flight.
Valori ammessi:
  1 (Inattivo)
  3 (Prenotato)
  2 (Archiviato)
  10 (In erogazione)
  11 (Erogazione Terminata)
  12 (Erogazione Futura)
  13 (Errata)
  14 (Erogazione Incompleta)

Esempio

{  
   "resource":{  
      "rows":[  
         {  
            "start_ts":"2015-02-10T00:00:00.000Z",
            "ctr":0,156,
            "last_edit_by":1275,
            "advertiser_description":"adv descr 1",
            "osi":-1,
            "order_description":"order descr 1",
            "imps_goal_daily":1000,
            "description":"descr 1",
            "last_edit_ts":"2015-11-10T14:34:48.373Z",
            "layer":50,
            "advertiser_id":3958,
            "imps_served":20848,
            "absolute_end_ts":”2015-12-10T23:00:00.000Z”,
            "imps_distribution":1,
            "flight_cap_description":"flight cap descr 1",
            "marker":0,
            "subflight_ref_code":"30019-3AB",
            "flight_cap_flight_ref_code":"30019-159832-3",
            "desired_end_ts":”2015-02-10T16:00:00.000Z”,
            "click_served":0,
            "imps_goal_total":30000,
            "order_id":16715,
            "subflight_id":162034,
            "status":1
         }
      ],
      "rows_total_number":1
   },
   "isError":false
}


 2.5  nodes

 2.5.1  Get nodes

	Restituisce l'alberatura completa dei siti del customer corrente.

 2.5.1.1  Request


Metodo
URI
POST
nodes

Header

Nessuno

Parametri

Nessuno

Body

Vuoto (eccetto il token).

Esempio

POST /api/v1/nodes

{
	"token":"67f82b35-0733-48d6-a1c8-42505e640483"
}



 2.5.1.2  Response

Header

Nessuno

Body

Il body contiene esclusivamente l'alberatura del customer. In particolare l'attributo “resource” punta al nodo radice dell'albero (oggetto Node).



Node

Campo
Tipo
Descrizione/Valori
node_id
number
Identificatore univoco per il singolo nodo.
parent_node_id
number
Identificatore univoco per il nodo padre.
code
string
Codice alfanumerico del nodo.
description
string
Nome esteso del nodo.
ext_ref_code
string
Percorso completo del nodo all'interno dell'alberatura, con i nodi indicati dai relativi codici.
level
number
Livello del nodo all'interno dell'alberatura:
Valori ammessi:
0: nodo fittizio che indica la radice dell'albero;
1: editore;
2: sito;
3: sezione;
4: canale;
5: area.
children
Node[]
Array contenente i nodi figli.

Esempio

{
  "resource": {
    "code": "",
    "level": 0,
    "children": [
      {
        "code": "PUB1",
        "level": 1,
        "children": [
          {
            "code": "ST1",
            "level": 2,
            "description": "Site 1",
            "ext_ref_code": "PUB1,ST1",
            "node_id": 100002,
            "parent_node_id": 100001
          }
        ],
        "description": "Publisher 1",
        "ext_ref_code": "PUB1",
        "node_id": 100001,
        "parent_node_id": 100000
      },
      {
        "code": "PUB2",
        "level": 1,
        "children": [
          {
            "code": "ST2",
            "level": 2,
            "children": [
              {
                "code": "SC1",
                "level": 3,
                "children": [
                  {
                    "description": "Channel 1",
                    "code": "CH1",
                    "level": 4,
                    "ext_ref_code": "PUB2,ST2,SC1,CH1",
                    "node_id": 25091,
                    "parent_node_id": 25090
                  }
                ],
                "description": "Section 1",
                "ext_ref_code": "PUB2,ST2,SC1",
                "node_id": 25090,
                "parent_node_id": 25089
              }
            ],
            "description": "Site 2",
            "ext_ref_code": "PUB2,ST2",
            "node_id": 25089,
            "parent_node_id": 25088
          }
        ],
        "description": "Publisher 2",
        "ext_ref_code": "PUB2",
        "node_id": 25088,
        "parent_node_id": 100000
      }
    ],
    "description": "",
    "ext_ref_code": "",
    "node_id": 100000,
    "parent_node_id": null
  },
  "isError": false
}


 2.6  sizesPositions

 2.6.1  Get sizes and positions

	Restituisce tutte le ad size associate ai nodi specificati e le relative position.
Se non viene fornito alcun nodo in input, vengono recuperate tutte le size per il customer corrente.


 2.6.1.1  Request


Metodo
URI
POST
sizesPositions

Header

Nessuno

Parametri

Nessuno

Body

Campo
Tipo
Descrizione/Valori
nodes
number[]
Array contenente gli id dei nodi.

Esempio

POST /api/v1/sizesPositions

{
	"token": "53832d8f-24d7-4401-8ab3-8fa94762e3c0",
	"request": {
		"nodes": [
			101972,
			100001
		]
	}
}


 2.6.1.2  Response

Header

Nessuno

Body

Size

Campo
Tipo
Descrizione/Valori
id
number
Identificatore univoco per la singola size.
description
string
Nome esteso della size.
positions
string[]
Position associate alla size.

Esempio

{
  "resource": {
    "sizes": [
      {
        "id": 219,
        "description": "APP ANDROID Background",
        "positions": [
          "u"
        ]
      },
      {
        "id": 49,
        "description": "APP ANDROID BANNER",
        "positions": [
          "1",
          "2",
          "3",
          "4",
          "5",
          "u"
        ]
      },
      {
        "id": 314,
        "description": "APP ANDROID BILLBOARD",
        "positions": [
          "u"
        ]
      }
    ]
  },
  "isError": false
}


 2.7  reports/monetization

 2.7.1  Get monetization report

	Restituisce un report contenente dei parametri che permettono di valutare il reale guadagno fornito dalle campagne corrispondenti ai criteri specificati. Le campagne sono raggruppate in base a delle categorie definite dall'utente.



 2.7.1.1  Request


Metodo
URI
POST
/reports/monetization/

Header

Nessuno

Parametri

Nessuno

Body

Campo
Tipo
Descrizione/Valori
nodes
(opzionale)
Node[]
Array contenente i nodi a partire dai quali determinare le campagne da includere nel report.
Se non viene passato alcun nodo viene considerata l'intera alberatura del customer corrente.
startDate
string

endDate
string

sizes
(opzionale)
number[]

positions
(opzionale)
string[]


Node

Campo
Tipo
Descrizione/Valori
nodeId
number

level
number
Livello del nodo all'interno dell'alberatura:
Valori ammessi:
0: nodo fittizio che indica la radice dell'albero;
1: editore;
2: sito;
3: sezione;
4: canale;
5: area.


Esempio

POST /api/v1/reports/monetization/

{
	"token": "88a77d44-aa7a-476f-9e5a-a85b86678900",
	"request":
	{
		"nodes" : [
			{
				"node_id" : 100002,
				"level" : 2
			},
			{
				"node_id" : 25091,
				"level" : 4
			}
		],
		"startDate": "2016-11-01",
		"endDate": "2016-11-10",
		"sizeId": [
			1,
			2
		],
		"position": [
			"u",
			"a1"
		]
	}
}


 2.7.1.2  Response

Header

Nessuno

Body

Campo
Tipo
Descrizione/Valori
rows
ReportItem[]
Array contenente i dati del report. Ogni oggetto rappresenta una singola categoria di campagne definita dall'utente.

ReportItem

Campo
Tipo
Descrizione/Valori
revenueAggregation
string
Categoria di campagne definita dall'utente.
imps
number
Numero di impression in milioni.
impsPerc
number
Percentuale di impression rispetto al totale considerato dal report.
price
number
Guadagno generato dalla campagna in migliaia.
pricePerc
number
Percentuale di guadagno rispetto al totale considerato dal report.
eCpm
number
Cost per mille effettivo.

Esempio

{
  "resource": {
    "rows": [
      {
        "revenueAggregation": "Total",
        "imps": 70.47,
        "impsPerc": 100,
        "price": 193.47,
        "pricePerc": 100,
        "eCpm": 2.75
      },
      {
        "revenueAggregation": "Gold Clients",
        "imps": 30,
        "impsPerc": 43,
        "price": 100,
        "pricePerc": 52,
        "eCpm": 3.33
      },
      {
        "revenueAggregation": "Silver Clients",
        "imps": 40.47,
        "impsPerc": 57,
        "price": 93.47,
        "pricePerc": 48,
        "eCpm": 2.31
      }
    ]
  },
  "isError": false
}

